# テーブルとレイヤー

TABLESセクションには、図面全体で使用されるスタイル定義が格納されます。これらは「定義」であり、実際の図形要素（エンティティ）は ENTITIES セクションで参照されます。

## テーブルの構造

すべてのテーブルは以下の構造を持ちます：

```text
  0
TABLE
  2
テーブル名
  5
ハンドル
 70
エントリ数
  0
エントリ1
  ...
  0
エントリ2
  ...
  0
ENDTAB
```

## LAYER テーブル（画層）

**役割**: 画層（レイヤー）の定義を格納します。各エンティティは必ず1つの画層に属します。

### LAYERエントリの構造

```text
  0
LAYER
  5
ハンドル
  2
LayerName
 70
フラグ
 62
色番号
  6
線種名
```

**主要なグループコード**:

| コード | 型 | 説明 |
| :--- | :--- | :--- |
| `2` | 文字列 | 画層名 |
| `70` | 整数 | フラグ（1=凍結、2=新規ビューポートで凍結、4=ロック） |
| `62` | 整数 | 色番号（0=ByBlock、256=ByLayer、1-255=RGBインデックス） |
| `6` | 文字列 | 線種名（`CONTINUOUS` など） |

### 例：画層の定義

```text
  0
TABLE
  2
LAYER
  5
2
 70
2
  0
LAYER
  5
10
  2
0
 70
0
 62
7
  6
CONTINUOUS
  0
LAYER
  5
11
  2
MyLayer
 70
0
 62
1
  6
DASHED
  0
ENDTAB
```

**実装上の注意**: 
- 画層名 `"0"` は常に存在し、デフォルト画層として機能します。
- 色番号 `256` は「ByLayer」（画層の色を使用）を意味します。
- フラグ `70` のビット `1` が立っている場合、その画層は凍結（非表示）されます。

## LTYPE テーブル（線種）

**役割**: 線種（実線、破線、一点鎖線など）の定義を格納します。

### LTYPEエントリの構造

```text
  0
LTYPE
  5
ハンドル
  2
線種名
 70
フラグ
  3
説明文
 72
配置コード
 73
ダッシュ要素数
 40
総パターン長
 49
ダッシュ長1
 49
ダッシュ長2
  ...
```

**主要なグループコード**:

| コード | 型 | 説明 |
| :--- | :--- | :--- |
| `2` | 文字列 | 線種名 |
| `3` | 文字列 | 説明文 |
| `40` | 浮動小数点 | パターンの総長さ |
| `49` | 浮動小数点 | ダッシュ/スペースの長さ（正=線、負=空白、0=点） |
| `73` | 整数 | ダッシュ要素の数 |

### 例：破線の定義

```text
  0
LTYPE
  5
5
  2
DASHED
 70
0
  3
__ __ __
 72
65
 73
2
 40
19.05
 49
12.7
 49
-6.35
  0
ENDTAB
```

この例では、`12.7` 単位の線と `6.35` 単位の空白を繰り返す破線パターンを定義しています。

**実装上の注意**: 
- `CONTINUOUS` は常に存在し、実線を表します。
- パターンは循環的に繰り返されます。

## STYLE テーブル（文字スタイル）

**役割**: 文字スタイル（フォント、高さ、幅係数など）の定義を格納します。

### STYLEエントリの構造

```text
  0
STYLE
  5
ハンドル
  2
スタイル名
 70
フラグ
 40
固定高さ（0=可変）
 41
幅係数
 50
傾斜角度
 71
テキスト生成フラグ
 42
最後に使用した高さ
  3
フォントファイル名
  4
ビッグフォントファイル名
```

**主要なグループコード**:

| コード | 型 | 説明 |
| :--- | :--- | :--- |
| `2` | 文字列 | スタイル名 |
| `40` | 浮動小数点 | 固定高さ（0の場合は可変） |
| `41` | 浮動小数点 | 幅係数（1.0=標準） |
| `50` | 浮動小数点 | 傾斜角度（度） |
| `3` | 文字列 | フォントファイル名（例: `txt.shx`） |

### 例：文字スタイルの定義

```text
  0
STYLE
  5
3
  2
STANDARD
 70
0
 40
0.0
 41
1.0
 50
0.0
 71
0
 42
2.5
  3
txt
  4

  0
ENDTAB
```

**実装上の注意**: 
- スタイル名 `"STANDARD"` は常に存在します。
- フォントファイル名は、SHXファイル（AutoCAD専用）またはTTFファイル名を指定します。

## その他のテーブル

### VIEW テーブル

名前付きビュー（表示範囲と視点）の定義を格納します。

### UCS テーブル

ユーザー座標系（User Coordinate System）の定義を格納します。

### VPORT テーブル

ビューポート（画面表示領域）の定義を格納します。モデル空間とレイアウト空間で異なる設定を持ちます。

## エンティティでの参照

エンティティは、これらのテーブルエントリを**名前**で参照します：

```text
  0
LINE
  8
MyLayer        ← LAYERテーブルの "MyLayer" を参照
  6
DASHED         ← LTYPEテーブルの "DASHED" を参照
 10
0.0
 20
0.0
 11
10.0
 21
10.0
```

**実装上の注意**: 
- 参照される画層や線種が存在しない場合、多くのCADソフトはデフォルト値（画層 `"0"`、線種 `"CONTINUOUS"`）を使用します。
- パーサーは、エンティティを読み込む前にテーブルを読み込み、名前解決のための辞書を構築する必要があります。
