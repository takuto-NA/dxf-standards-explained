# 共通エンティティ

ENTITIESセクションには、実際に描画される図形要素（エンティティ）が格納されます。ここでは、最も頻繁に使用されるエンティティの構造を解説します。

## エンティティの共通プロパティ

すべてのエンティティは、以下の共通プロパティを持ちます：

| グループコード | 型 | 説明 |
| :--- | :--- | :--- |
| `8` | 文字列 | 画層名（LAYERテーブルを参照） |
| `6` | 文字列 | 線種名（LTYPEテーブルを参照、省略可） |
| `62` | 整数 | 色番号（256=ByLayer、0=ByBlock、1-255=RGBインデックス） |
| `48` | 浮動小数点 | 線種スケール（省略可） |
| `60` | 整数 | 可視性（0=可視、1=不可視） |
| `5` | 文字列 | ハンドル（AutoCAD 2000以降、オブジェクトID） |

## LINE（線）

**説明**: 2点間を結ぶ直線を定義します。

### グループコード

| コード | 型 | 説明 |
| :--- | :--- | :--- |
| `10, 20, 30` | 浮動小数点 | 始点の X, Y, Z 座標 |
| `11, 21, 31` | 浮動小数点 | 終点の X, Y, Z 座標 |

### 例

```text
  0
LINE
  5
100
  8
0
 10
0.0
 20
0.0
 30
0.0
 11
10.0
 21
10.0
 31
0.0
```

## CIRCLE（円）

**説明**: 中心点と半径で定義される円を描画します。

### グループコード

| コード | 型 | 説明 |
| :--- | :--- | :--- |
| `10, 20, 30` | 浮動小数点 | 中心点の X, Y, Z 座標 |
| `40` | 浮動小数点 | 半径 |
| `210, 220, 230` | 浮動小数点 | 押し出し方向（法線ベクトル、OCS用） |

### 例

```text
  0
CIRCLE
  5
101
  8
0
 10
5.0
 20
5.0
 30
0.0
 40
2.5
```

**実装上の注意**: 法線ベクトル（`210, 220, 230`）が指定されていない場合、デフォルトは `(0, 0, 1)`（世界Z軸）とみなされます。これにより、円はXY平面に配置されます。

## ARC（円弧）

**説明**: 中心点、半径、開始角度、終了角度で定義される円弧を描画します。

### グループコード

| コード | 型 | 説明 |
| :--- | :--- | :--- |
| `10, 20, 30` | 浮動小数点 | 中心点の X, Y, Z 座標 |
| `40` | 浮動小数点 | 半径 |
| `50` | 浮動小数点 | 開始角度（度、反時計回り） |
| `51` | 浮動小数点 | 終了角度（度、反時計回り） |
| `210, 220, 230` | 浮動小数点 | 押し出し方向（法線ベクトル） |

### 例

```text
  0
ARC
  5
102
  8
0
 10
0.0
 20
0.0
 30
0.0
 40
5.0
 50
0.0
 51
90.0
```

この例では、中心 `(0, 0, 0)`、半径 `5.0`、角度 `0°` から `90°` までの円弧を描画します。

**実装上の注意**: 角度は度単位で、X軸の正の方向から反時計回りに測定されます。

## LWPOLYLINE（軽量ポリライン）

**説明**: 2Dポリライン（連続する線分や円弧の集合）を効率的に表現します。`POLYLINE` よりも軽量で、2D専用です。

### グループコード

| コード | 型 | 説明 |
| :--- | :--- | :--- |
| `90` | 整数 | 頂点数 |
| `70` | 整数 | フラグ（1=閉じた、2=フィット曲線、4=スプライン） |
| `38` | 浮動小数点 | 標高（Z座標、全頂点共通） |
| `10, 20` | 浮動小数点 | 頂点1の X, Y 座標（OCS） |
| `10, 20` | 浮動小数点 | 頂点2の X, Y 座標（OCS） |
| `...` | ... | 以降、頂点数分繰り返し |
| `42` | 浮動小数点 | バルジ（各頂点、0=直線、非0=円弧） |

### 例：閉じた四角形

```text
  0
LWPOLYLINE
  5
103
  8
0
 90
4
 70
1
 10
0.0
 20
0.0
 10
10.0
 20
0.0
 10
10.0
 20
10.0
 10
0.0
 20
10.0
```

**実装上の注意**: 
- 頂点の座標は **OCS（オブジェクト座標系）** で定義されます。法線ベクトルが指定されていない場合、XY平面とみなされます。
- バルジ（`42`）が `0` でない場合、その頂点は円弧の接続点として扱われます。バルジの値は、円弧の角度の1/4のタンジェントです。

## TEXT（文字）

**説明**: 単一行のテキスト文字列を描画します。

### グループコード

| コード | 型 | 説明 |
| :--- | :--- | :--- |
| `10, 20, 30` | 浮動小数点 | 挿入点（左下基準）の X, Y, Z 座標 |
| `40` | 浮動小数点 | 文字高さ |
| `1` | 文字列 | テキスト文字列 |
| `50` | 浮動小数点 | 回転角度（度） |
| `7` | 文字列 | 文字スタイル名（STYLEテーブルを参照） |
| `41` | 浮動小数点 | 幅係数（1.0=標準） |
| `51` | 浮動小数点 | 傾斜角度（度） |

### 例

```text
  0
TEXT
  5
104
  8
0
 10
5.0
 20
5.0
 30
0.0
 40
2.5
  1
Hello, DXF!
 50
0.0
  7
STANDARD
```

## MTEXT（複数行テキスト）

**説明**: 複数行のテキストブロックを描画します。`TEXT` よりも高度な書式設定が可能です。

### 主要なグループコード

| コード | 型 | 説明 |
| :--- | :--- | :--- |
| `10, 20, 30` | 浮動小数点 | 挿入点の X, Y, Z 座標 |
| `40` | 浮動小数点 | 文字高さ |
| `1` | 文字列 | テキスト文字列（改行は `\P` で表現） |
| `71` | 整数 | アタッチメントポイント（1=左上、2=中上、...） |
| `50` | 浮動小数点 | 回転角度 |

## エンティティの選択指針

- **単純な線**: `LINE`
- **円**: `CIRCLE`
- **円弧**: `ARC`
- **2Dの連続線**: `LWPOLYLINE`（推奨）または `POLYLINE`
- **3Dの連続線**: `POLYLINE`（`LWPOLYLINE`は2D専用）
- **単一行テキスト**: `TEXT`
- **複数行テキスト**: `MTEXT`

## 実装のベストプラクティス

1. **OCSの理解**: 多くのエンティティ（特に `CIRCLE`, `ARC`, `LWPOLYLINE`）はOCSで定義されます。WCSへの変換には、[座標系の解説](../geometry/coordinate-systems.md)を参照してください。
2. **デフォルト値の処理**: 画層名や線種が指定されていない場合、デフォルト値（画層 `"0"`、線種 `"CONTINUOUS"`）を使用します。
3. **単位の一貫性**: 座標値と寸法（半径、高さなど）は同じ単位系で解釈する必要があります。
