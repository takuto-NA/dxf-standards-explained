# フリーソフトでのDXF活用ガイドライン

AutoCAD以外のフリーソフト（LibreCAD, QCAD, FreeCAD, Inkscape等）でDXFファイルを扱う際、互換性の問題で図面が崩れたり、読み込めなかったりすることが頻繁にあります。本ガイドラインでは、これらのソフトを組み合わせて使用する際のベストプラクティスをまとめます。

---

## 1. 主要なフリーソフトとその特性

| ソフト名 | 分類 | DXF内部エンジン | 得意なDXFバージョン | 注意点 |
| :--- | :--- | :--- | :--- | :--- |
| **LibreCAD** | 2D CAD | libdxfrw | R12, R14 | スプラインや複雑なエンティティに弱い |
| **QCAD** | 2D CAD | dxflib / ODA | R12, R15 (AC1015) | コミュニティ版は最新形式(2018等)の保存に制限 |
| **FreeCAD** | 3D CAD | libdxfrw | R12, R14, 2000 | 2D図面の微調整には不向き |
| **Inkscape** | ベクター | 内蔵スクリプト | R12, R14 (Desktop) | 単位(mm vs px)やDPI設定でサイズが狂いやすい |
| **Blender** | 3D | 内蔵アドオン | R12 (AC1009) | メッシュベースのため、円弧が多角形になる |

---

## 2. 互換性を高める書き出し設定（エクスポート）

他のソフトで開くことを前提にDXFを保存する場合、以下の設定を推奨します。

### バージョン選択のルール
- **AutoCAD R12 (AC1009) 形式**: **最も安全。** 30年以上前の仕様ですが、ほぼすべてのフリーソフト、Webビューワー、加工機（レーザー、CNC）で読み込めます。ただし、曲線が細かい直線（ポリライン）に分解されることがあります。
- **AutoCAD 2000 (R15/AC1015) 形式**: **バランス重視。** スプライン（曲線）を曲線のまま保持でき、QCADやFreeCADで扱う場合に適しています。

### 文字コードの注意
- 日本語を含む図面の場合、最新ソフトは **UTF-8** を想定しますが、古いソフトや加工機は **Shift-JIS (CP932)** を期待することがあります。
- 文字化けが発生した場合は、保存時のエンコーディング設定を確認してください。

---

## 3. 読み込み時のトラブルシューティング（インポート）

### 図面が真っ白、または一部の線が消えている
1. **ズーム機能**: `全図面を表示 (Auto Zoom / Zoom Extents)` を試してください。座標が遠くに飛んでいるだけのケースが多いです。
2. **非対応エンティティ**: `SPLINE`, `ELLIPSE`, `MTEXT`, `HATCH` などはソフトによって無視されます。
    - **対策**: 元のソフトでこれらを「分解（Explode）」して、単純な `LINE` や `ARC` に変換してから保存してください。

### スケール（大きさ）がおかしい
- DXFには「単位」の概念が曖昧な部分があります（`$INSUNITS`）。
- **Inkscape特有の罠**: Inkscape 0.92以降、内部解像度が 90 DPI から 96 DPI に変更されました。エクスポート時の `Base unit` や `DPI` 設定が加工機側と一致していないと、図面が 1.06 倍、あるいは 0.93 倍の大きさで出力されることがあります。
- **対策**: インポート設定で `ミリメートル (mm)` が指定されているか確認し、既知の長さの線分（例：100mmの正方形）を必ず含めてテストカットや検図を行ってください。

---

## 4. 運用ガイドライン（ベストプラクティス）

### ① 基本エンティティのみを使用する
高度な機能（ダイナミックブロック、複雑なハッチング、プロキシオブジェクト）は避け、以下の基本要素で構成するのが最も安全です。
- `LINE` (線分)
- `CIRCLE` (円)
- `ARC` (円弧)
- `POLYLINE / LWPOLYLINE` (ポリライン)

### ② ブロックを解除（分解）する
独自のブロック定義は、フリーソフトで読み込んだ際に位置がずれたり、属性情報（ATTRIB）が消えたりすることがあります。最終的なデータ交換用には、ブロックを解除して「バラの線」にすることをお勧めします。

### ③ 画層（レイヤー）名を英数字にする
日本語の画層名は、ソフトをまたぐと文字化けし、表示・非表示の制御ができなくなることがあります。
- 例: `外形線` → `OUTLINE`, `寸法` → `DIM`

### ④ 閉じたループを確認する（加工用）
レーザー加工やCNCで使用する場合、ポリラインが「閉じている（Closed）」ことが重要です。
- LibreCADやQCADの「閉じたポリラインの作成」機能を使用して、端点が完全に一致しているか確認してください。

---

## 5. 推奨されるワークフロー例

### イラストを加工機（DXF）に送る場合
1. **Inkscape** でパスを作成。
2. パスをすべて選択し、`パス -> オブジェクトをパスへ` を適用。
3. `名前を付けて保存` で **Desktop Cutting Plotter (AutoCAD DXF R14)** を選択。
4. **LibreCAD** で開き、寸法が正しいか確認して微調整。
5. R12形式で最終保存。

### 3Dモデルの断面を2D図面にする場合
1. **FreeCAD** でモデルを作成。
2. `TechDraw` ワークベンチで2D投影図を作成。
3. DXFエクスポート。
4. **QCAD** で読み込み、線種や画層を整える。

---

関連：[よくある罠](./common-pitfalls.md) | [3D CADとの互換性](./3d-cad-interoperability.md)

